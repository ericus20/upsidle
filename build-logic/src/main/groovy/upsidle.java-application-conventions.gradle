/*
 * This file was generated by the Gradle 'init' task.
 *
 * This project uses @Incubating APIs which are subject to change.
 */

plugins {
    // Apply the common convention plugin for shared build configuration between library and application projects.
    id 'upsidle.java-common-conventions'
    id 'test-report-aggregation'

    // Apply the application plugin to add support for building a CLI application in Java.
    id 'application'
    id 'org.springframework.boot'
    id 'io.spring.dependency-management'

}

testing {
    suites {
        integrationTest(JvmTestSuite) {
            dependencies {
                implementation project()
            }

            targets {
                all {
                    testTask.configure {
                        maxHeapSize = '512m'
                        shouldRunAfter(test)
                    }
                }
            }
        }
    }
}

tasks.named('check') {
    dependsOn(testing.suites.integrationTest)
}

bootJar {
    enabled = true
}

tasks.named('integrationTestAggregateTestReport') {
    dependsOn tasks.named('testAggregateTestReport', TestReport)
    mustRunAfter 'testAggregateTestReport'
}

tasks.named('check') {
    dependsOn tasks.named('integrationTestAggregateTestReport', TestReport)
}
